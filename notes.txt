========================================================
GREENFARM â€” VENDOR DASHBOARD SAFETY CHECKLIST
Permanent Debug Script (Supabase + Next.js)
========================================================


############################
ðŸ”¥ CORE TRUTH (NEVER FORGET)
############################

In THIS project:

auth.users.id  ===  vendors.id  ===  leads.vendor_id

There is NO user_id column.

So ALWAYS query:

.eq("vendor_id", user.id)

NEVER:

.eq("user_id", ...)
.join vendors
.fetch vendor first

Vendor IS the user.


========================================================
STEP-BY-STEP DEBUG CHECKLIST
========================================================


-----------------------------------
STEP 1 â€” Confirm user is logged in
-----------------------------------

Temporary log:

console.log("USER ID:", user.id);

If undefined â†’ auth problem
If value exists â†’ continue



-----------------------------------
STEP 2 â€” Confirm DB has leads
-----------------------------------

Run in Supabase SQL:

select id, vendor_id, created_at
from leads
order by created_at desc;

If rows exist â†’ backend OK
If empty â†’ no data issue (frontend innocent)



-----------------------------------
STEP 3 â€” Confirm correct filter
-----------------------------------

âœ… ALWAYS:

.eq("vendor_id", user.id)

âŒ NEVER:

.eq("user_id", user.id)
.eq("vendors.id", ...)
join vendors


This single mistake causes:
- empty table
- empty chart
- "No enquiries yet"
- disappearing dashboard



-----------------------------------
STEP 4 â€” Quick frontend test
-----------------------------------

Add temporarily:

console.log("LEADS COUNT:", leads.length);

If 0  â†’ backend filter wrong
If >0 â†’ frontend rendering bug



-----------------------------------
STEP 5 â€” Prevent React crashes
-----------------------------------

ALWAYS sanitize Supabase nulls:

buyer_name ?? ""
buyer_phone ?? ""
product_name ?? ""
created_at ?? new Date().toISOString()

Because:
null â†’ chart crash
null â†’ table disappears



-----------------------------------
STEP 6 â€” Clear Next.js cache
-----------------------------------

When UI acts weird:

Ctrl + C
rmdir /s /q .next
npm run dev

Turbopack cache lies A LOT.



========================================================
SAFE BACKEND TEMPLATE (COPY FOREVER)
========================================================

export async function getVendorDashboardData(userId: string) {
  const supabase = await supabaseServer();

  const { data } = await supabase
    .from("leads")
    .select("*")
    .eq("vendor_id", userId)
    .order("created_at", { ascending: false });

  return {
    vendor: { id: userId },
    leads: data ?? [],
  };
}



========================================================
SAFE FRONTEND RULES
========================================================

âœ” always pass [] not null
âœ” always sanitize strings
âœ” always default vendorId/email to ""
âœ” never block rendering
âœ” table + chart should ALWAYS mount



========================================================
IF DASHBOARD BREAKS AGAIN
========================================================

Do this IN ORDER:

1. console.log(user.id)
2. SQL check leads
3. confirm .eq("vendor_id", user.id)
4. console.log(leads.length)
5. delete .next
6. restart dev

99% fixed in under 2 minutes.



========================================================
END
========================================================
